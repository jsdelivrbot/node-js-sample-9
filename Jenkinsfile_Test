node('docker') {
  def image
  
  stage('publish') {
    sh 'docker tag 192.168.10.102:5000/helloworld:dev 192.168.10.102:5000/helloworld:test'
    sh 'docker push 192.168.10.102:5000/helloworld:test'
    image = docker.image('192.168.10.102:5000/helloworld')
    image.pull()
  }
  
  stage('deploy') {
    env.TAG = "test"
    sh 'rancher --env ${ENVID} up -p -d --upgrade -s image helloworld'
  }
  
}
